version: '1.0'
steps:

  build_dev_step:
    type: build
    dockerfile: Dockerfile.dev
    image-name: ${{dockerhubUsername}}/demochat-alpine
    tag: dev

  print_env:
    image: ${{build_dev_step}}
    working_directory: /root/demochat
    environment:
      - TRIPLESEC_SECRET=${{TRIPLESEC_SECRET}}
      - NEW_SECRET=${{NEW_SECRET}}
    commands:
      - npm run env

  unit_tests:
    image: ${{build_dev_step}}
    working_directory: /root/demochat
    commands:
      - npm run test
      - cf_export TAG='qwerty=we'
      - cat file.env >> /codefresh/volume/env_vars_to_export

  unit_tests:
    image: ${{build_dev_step}}
    working_directory: /root/demochat
    commands:
      - echo $TAG
      - echo $TAG1
      - echo $TAG2

  push-to-dockerhub:
    type: push
    candidate: ${{build_project}}
    credentials:
      username: ${{dockerhubUsername}}
      password: ${{dockerhubPassword}}
    tags: [ ${{TAG}}, ${{TAG1}}, latest ]
